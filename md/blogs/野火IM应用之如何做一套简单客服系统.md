# 野火IM应用之如何做一套简单客服系统
在之前一篇文章中已经介绍了使用野火IM来做客服系统的方法，按照该方法可以实现传统客服的所有功能和逻辑，能够实现出一套功能强大的客服系统。但问题是太复杂，需要开发的内容太多，很多人只需要杀只鸡，不需要锻造这把40米长的大砍刀。最近跟客户探讨交流过程中，我们又想到了一个简单客服系统的实现方法，目标是使用野火IM简单开发就能完成基本的客服服务。

## 用户需求
客户A咨询问题，与客服甲沟通，客服甲无法解决，需要转给客服乙，乙需要了解到之前的沟通结果，乙与A的沟通甲要能同步看到。之后用户A再次发起客服请求时，任意分配的客服都能看到之前的甲乙客服与客户直接的聊天记录。

## 需求分析
技术要点有两点，一个是能够转接客服，切换不同的客服人员进行聊天；另外一个是所有的聊天记录都要保存，客服和用户都要能看到。群组功能能满足这个需求，可以把新的客服人员拉进来就能实现转接功能，而且群组可以查看加入之前的消息记录，这样历史记录也不是问题了

## 实现步骤
1. 客户点击发起客服，请求到应用后台，应用后台检查当前客户是否存在客服群组，如果不存在就创建一个，确保群存在且客户在群中。
2. 应用后台根据业务需求选择合适的客服加入到群组中，返回群组ID给客户端。如果无可用客服返回失败给客户端。
3. 客户端收到返回的群组ID后，进入到对话界面，就可以在群里与客服交流。
4. 当客服需要转接时，请求后台，后台把另外一个客服加入到群组中去。新的客服可以下拉了解到之前的信息。
5. 后台可以把旧客服踢掉如果不需要旧客服实时看到聊天内容，如果需要可以保留旧客服在群中。
6. 当客服结束时，把客服都踢出群组。
7. 下次客服服务时，客服加入后可以继续看到之前的所有消息

## 更多细节
* 客服群组就是个普通群组，可以用用户id和特殊字符串拼接成群组ID，比如客户id是usera，客服群组可以是kefuee_usera。每个客户都会有一个客服群组，可以把客户一直保留在这个群中，客服服务时客服加入群组，结束服务时客服退出群组。
* 客服群组在创建时可以在extra中加入标志表明是客服群组，这样就可以修改群组的各种提示语还有UI展现。比如加入群组和退出群组等可以改成服务开始提示和服务结束等。UI上屏蔽掉群组的设置等，还有添加快速发送商品和订单等自定义功能。
* 服务器端需要打开拉取历史消息功能，只有这个功能打开才能获取都群的历史消息。专业版可以控制新加入的成员是否能够获取群的历史信息，这个开关要打开，社区版默认支持获取加入前的历史消息。
* 客服端如果是移动客户端或者是PC客户端就需要特殊处理一下，因为历史消息存储在本地数据库中，拉取历史消息是先读取本地消息，本地读取不到再拉取历史，如果一个客户经过多个客服服务，客服被加入和踢出多次，本地消息记录就会不全。处理方法可以是在每次加入和退出时清理一下本会话的消息，这样就能保证从服务器拉取到完整的历史消息。Web和小程序端没有这个问题。
* 可以使用不同的line，能够与正常会话分开。

## 总结
这样设计的好处是特别的简单，只需要在应用服务开发很少的逻辑，在客户端实现的内容也特别的少，但客服的基本功能都能够满足，非常适合普通公司二开后自用。
